<!DOCTYPE html>
<html lang="ko">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<head>
  <meta charset="UTF-8" />
  <title>ê³¼íƒ‘ì˜ ë¹„ë°€ ë…¸íŠ¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- âœ… jsPDFë¥¼ head ì•ˆìœ¼ë¡œ -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- âœ… í°íŠ¸ base64 ìŠ¤í¬ë¦½íŠ¸ë„ headì—ì„œ deferë¡œ -->
  <script defer src="./NanumGothic.base64.js"></script>
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Apple SD Gothic Neo",
        "Noto Sans KR", sans-serif;
      background: radial-gradient(circle at top left, #ffe0f7, #e3f2ff 40%, #f5f5ff 80%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 24px;
      color: #222;
    }

    .app-container {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 32px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.08);
      padding: 32px 28px 28px;
      width: 100%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    header {
      text-align: center;
    }

    header h1 {
      font-size: 2.6rem;
      line-height: 1.2;
      letter-spacing: 0.08em;
      font-weight: 800;
      color: #ff66a2;
      text-shadow: 0 4px 0 #ffd1e6;
    }

    header h1 span {
      display: inline-block;
      padding: 4px 14px;
      border-radius: 999px;
      background: #fff6fb;
      border: 2px solid #ffb6d9;
      margin-top: 8px;
      font-size: 1rem;
      color: #ff5b8b;
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .card {
      background: #ffffff;
      border-radius: 24px;
      padding: 20px 18px;
      flex: 1 1 260px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.04);
      border: 1px solid #f2e9ff;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title .badge {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fdf0ff;
      color: #b055ff;
      border: 1px solid #e2c5ff;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 12px;
    }

    label {
      font-size: 0.85rem;
      font-weight: 600;
      color: #444;
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      border-radius: 12px;
      border: 1px solid #e0d4ff;
      padding: 8px 10px;
      font-size: 0.9rem;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
      background: #fdfcff;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus,
    textarea:focus {
      border-color: #b388ff;
      box-shadow: 0 0 0 2px rgba(179, 136, 255, 0.25);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .file-input-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .file-input-wrapper input[type="file"] {
      font-size: 0.8rem;
    }

    .file-name {
      font-size: 0.8rem;
      color: #777;
    }

    .question-types {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 8px 10px;
      border-radius: 16px;
      background: #f6f7ff;
      border: 1px dashed #c3c7ff;
    }

    .question-types label {
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
    }

    .question-types input[type="radio"] {
      accent-color: #b388ff;
    }

    .bottom-card {
      border-radius: 24px;
    }

    .output-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .output-box {
      flex: 1 1 260px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .output-box h2 {
      font-size: 0.95rem;
      font-weight: 700;
      color: #444;
    }

    .output-box textarea {
      min-height: 150px;
      background: #faf7ff;
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .controls {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 4px;
      margin-bottom: 2px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff8fb1, #ff66a2);
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(255, 102, 162, 0.35);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(255, 102, 162, 0.45);
    }

    .btn-secondary {
      background: #f4f4ff;
      color: #555;
      border: 1px solid #d2d2ff;
    }

    .btn-secondary:hover {
      background: #ececff;
    }

    .helper-text {
      font-size: 0.75rem;
      color: #888;
    }

    @media (max-width: 768px) {
      .app-container {
        padding: 24px 18px 20px;
        border-radius: 24px;
      }

      header h1 {
        font-size: 2.1rem;
      }

      .controls {
        justify-content: center;
        flex-wrap: wrap;
      }
    }

      .output-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      
      .btn-icon {
        border: none;
        border-radius: 999px;
        padding: 4px 10px;
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        background: #f4f4ff;
        color: #555;
        border: 1px solid #d2d2ff;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }
      
      .btn-icon:hover {
        background: #ececff;
      }
    
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <h1>ê³¼íƒ‘ì˜ ë¹„ë°€ ë…¸íŠ¸<br /><span>Lecture Note &amp; Quiz Generator</span></h1>
    </header>

    <main>
      <form id="noteForm" onsubmit="register(event)">
        <!-- ìƒë‹¨: ì™¼ìª½ / ì˜¤ë¥¸ìª½ ë°•ìŠ¤ -->
        <div class="top-row">
          <!-- ì™¼ìª½ ë‘¥ê·¼ ë„¤ëª¨ ë°•ìŠ¤ -->
          <section class="card">
            <div class="card-title">
              âœï¸ ì…ë ¥ 1
              <span class="badge">ê³¼ëª© &amp; ê°•ì˜ìë£Œ</span>
            </div>

            <div class="form-group">
              <label for="subjectName">ê³¼ëª© ì´ë¦„</label>
              <input
                type="text"
                id="subjectName"
                placeholder="ì˜ˆ: ë””ì§€í„¸ ì‹ í˜¸ì²˜ë¦¬"
                required
              />
            </div>

            <div class="form-group">
              <label for="profStyle">êµìˆ˜ë‹˜ ìŠ¤íƒ€ì¼ / íŠ¹ì´ì‚¬í•­</label>
              <textarea
                id="profStyle"
                placeholder="ì˜ˆ: ê³„ì‚° ë¬¸ì œ ë¹„ìœ¨ ë†’ìŒ, ì¦ëª… ì¢‹ì•„í•˜ì‹¬, ì˜ˆì œ ì„¤ëª… ìœ„ì£¼ ë“±"
              ></textarea>
              <p class="helper-text">
                êµìˆ˜ë‹˜ì´ ì„ í˜¸í•˜ëŠ” ë¬¸ì œ ìœ í˜•, ìì£¼ ê°•ì¡°í•˜ëŠ” í‘œí˜„ ë“±ì„ ì ì–´ ì£¼ì„¸ìš”.
              </p>
            </div>

            <div class="form-group">
              <label for="lectureFile">ê°•ì˜ìë£Œ ì—…ë¡œë“œ</label>
              <div class="file-input-wrapper">
                <input
                  type="file"
                  id="lectureFile"
                  accept=".pdf,.ppt,.pptx,.doc,.docx,.txt"
                />
                <span id="fileName" class="file-name">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
              </div>
              <p class="helper-text">
                ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì´ íŒŒì¼ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ë…¸íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
              </p>
            </div>
          </section>

          <!-- ì˜¤ë¥¸ìª½ ë‘¥ê·¼ ë„¤ëª¨ ë°•ìŠ¤ -->
          <section class="card">
            <div class="card-title">
              ğŸ“œ ì…ë ¥ 2
              <span class="badge">ë¬¸ì œ ì„¤ì •</span>
            </div>

            <div class="form-group">
              <label for="questionCount">ë¬¸ì œ ìˆ˜</label>
              <input
                type="number"
                id="questionCount"
                min="1"
                max="50"
                value="5"
                required
              />
              <p class="helper-text">
                ìƒì„±í•  ì—°ìŠµ ë¬¸ì œ ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (1~50)
              </p>
            </div>

            <div class="form-group">
              <label>ë¬¸ì œ ìœ í˜•</label>
              <div class="question-types">
                <label>
                  <input
                    type="radio"
                    name="questionType"
                    value="ê°ê´€ì‹"
                    checked
                  />
                  ê°ê´€ì‹
                </label>
                <label>
                  <input type="radio" name="questionType" value="ë‹¨ë‹µì‹" />
                  ë‹¨ë‹µì‹
                </label>
                <label>
                  <input type="radio" name="questionType" value="ì„œìˆ í˜•" />
                  ì„œìˆ í˜•
                </label>
                <label>
                  <input type="radio" name="questionType" value="í˜¼í•©í˜•" />
                  í˜¼í•©í˜• (ìœ„ ìœ í˜• ì„ì–´ì„œ)
                </label>
              </div>
            </div>
          </section>
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="controls">
          <button type="button" class="btn-secondary" onclick="clearOutputs()">
            ğŸ”„ ì´ˆê¸°í™”
          </button>
          <button type="submit" class="btn-primary">
            âœ¨ ë¹„ë°€ ë…¸íŠ¸ &amp; ë¬¸ì œ ìƒì„±í•˜ê¸°
          </button>
        </div>

        <!-- ì•„ë˜ìª½ ë‘¥ê·¼ ë„¤ëª¨ ë°•ìŠ¤ -->
        <section class="card bottom-card">
          <div class="card-title">
            ğŸ’¡ ì¶œë ¥
            <span class="badge">ê°•ì˜ ì •ë¦¬ ë…¸íŠ¸ &amp; ë¬¸ì œì§€</span>
          </div>

<div class="output-grid">
  <!-- ê°•ì˜ ì •ë¦¬ ë…¸íŠ¸ ë°•ìŠ¤ -->
  <div class="output-box">
    <div class="output-header">
      <h2>ê°•ì˜ ì •ë¦¬ ë…¸íŠ¸</h2>
      <button
        type="button"
        class="btn-icon"
        onclick="downloadNotePDF()"
        title="ê°•ì˜ ì •ë¦¬ ë…¸íŠ¸ë¥¼ PDFë¡œ ì €ì¥"
      >
        ğŸ“„ PDF
      </button>
    </div>
    <textarea
      id="noteOutput"
      readonly
      placeholder="ì—¬ê¸°ì— AIê°€ ì •ë¦¬í•œ ê°•ì˜ ë…¸íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤."
    ></textarea>
  </div>

            <!-- ë¬¸ì œì§€ ë°•ìŠ¤ -->
          <div class="output-box">
              <div class="output-header">
                <h2>ë¬¸ì œì§€</h2>
                <button
                  type="button"
                  class="btn-icon"
                  onclick="downloadQuizPDF()"
                  title="ë¬¸ì œì§€ë¥¼ PDFë¡œ ì €ì¥"
                >
                  ğŸ“„ PDF
                </button>
              </div>
              <textarea
                id="quizOutput"
                readonly
                placeholder="ì—¬ê¸°ì— AIê°€ ìƒì„±í•œ ì—°ìŠµ ë¬¸ì œê°€ í‘œì‹œë©ë‹ˆë‹¤."
              ></textarea>
            </div>
          </div>
        </section>
      </form>
    </main>
  </div>

  <script>
    // â˜… í•„ìˆ˜ ìš”êµ¬ ì‚¬í•­: API ì„œë²„ ì£¼ì†Œ ìƒìˆ˜
    const SERVER_URL = "https://6725f18d-b73d-4faf-8093-2ec1d29bd274-00-2u1qx3fytvlzv.pike.replit.dev/generate_minutes"; // ë‚˜ì¤‘ì— ì‹¤ì œ ë°±ì—”ë“œ ì£¼ì†Œë¥¼ ì—¬ê¸°ì— ë„£ìœ¼ë©´ ë¨

    // íŒŒì¼ ì„ íƒ ì‹œ íŒŒì¼ ì´ë¦„ í‘œì‹œ
    document.getElementById("lectureFile").addEventListener("change", () => {
      const fileInput = document.getElementById("lectureFile");
      const fileNameSpan = document.getElementById("fileName");

      if (fileInput.files && fileInput.files.length > 0) {
        fileNameSpan.textContent = fileInput.files[0].name;
      } else {
        fileNameSpan.textContent = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
      }
    });

    // í¼ ì œì¶œ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ (í•„ìˆ˜: register í•¨ìˆ˜ ë‚´ë¶€ì— fetch POST í¬í•¨)
    function register(event) {
      event.preventDefault();
    
      const subjectName = document.getElementById("subjectName").value.trim();
      const profStyle = document.getElementById("profStyle").value.trim();
      const questionCount = parseInt(document.getElementById("questionCount").value, 10);
      const questionType =
        document.querySelector('input[name="questionType"]:checked')?.value || "";
    
      const lectureFileInput = document.getElementById("lectureFile");
      const file = lectureFileInput.files && lectureFileInput.files.length > 0
        ? lectureFileInput.files[0]
        : null;
    
      const noteOutput = document.getElementById("noteOutput");
      const quizOutput = document.getElementById("quizOutput");
    
      const formData = new FormData();
      formData.append("subjectName", subjectName);
      formData.append("profStyle", profStyle);
      formData.append("questionCount", String(questionCount));
      formData.append("questionType", questionType);
      if (file) formData.append("lectureFile", file); // âœ… íŒŒì¼ ìì²´ ì—…ë¡œë“œ
    
      fetch(SERVER_URL, {
        method: "POST",
        body: formData,
      })
        .then((response) => {
          if (!response.ok) throw new Error("Network response was not ok");
          return response.json();
        })
        .then((data) => {
          noteOutput.value = data.note || "ë…¸íŠ¸ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.";
          quizOutput.value = data.questions || "ë¬¸ì œê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.";
        })
        .catch((error) => {
          console.error("í†µì‹  ì˜¤ë¥˜:", error);
          noteOutput.value = "ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nConsole/ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸";
          quizOutput.value = "ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në¬¸ì œ ìƒì„± ê²°ê³¼ ì—†ìŒ";
          alert("AI ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në°±ì—”ë“œ ë¡œê·¸ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.");
        });
    }


    // ì¶œë ¥ ì˜ì—­ ì´ˆê¸°í™”
    function clearOutputs() {
      document.getElementById("noteOutput").value = "";
      document.getElementById("quizOutput").value = "";
    }


  // ì¶œë ¥ ì˜ì—­ ì´ˆê¸°í™”
  function clearOutputs() {
    document.getElementById("noteOutput").value = "";
    document.getElementById("quizOutput").value = "";
  }

  // ê³µí†µ PDF ìƒì„± í—¬í¼ í•¨ìˆ˜ (âœ… í•œê¸€ í°íŠ¸ ì„ë² ë“œ)
  function createPdfFromText(text, title, filename) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "mm", format: "a4" });
  
    // í•œê¸€ í°íŠ¸
    doc.addFileToVFS("NanumGothic.ttf", window.__KOR_FONT_BASE64__);
    doc.addFont("NanumGothic.ttf", "NanumGothic", "normal", "Identity-H");
    doc.setFont("NanumGothic");
  
    let y = 20;
  
    // ===== ì œëª© =====
    doc.setFontSize(18);
    doc.setFont("NanumGothic", "normal");
    doc.text(title, 10, y);
    y += 12;
  
    const lines = text.split("\n");
  
    lines.forEach((line) => {
      if (y > 280) {
        doc.addPage();
        y = 20;
      }
  
      // [1] [2] ê°™ì€ íŒŒíŠ¸ ì œëª©
      if (/^\[\d+\]/.test(line)) {
        y += 6;
        doc.setFontSize(14);
        doc.setTextColor(80, 40, 120); // ë³´ë¼í†¤
        doc.text(line, 10, y);
        y += 8;
        doc.setTextColor(0, 0, 0);
      }
  
      // ì†Œì œëª© (- , â— ë“±)
      else if (/^[-â—]/.test(line.trim())) {
        doc.setFontSize(11.5);
        doc.setTextColor(60, 60, 60);
        doc.text(line, 14, y);
        y += 6;
        doc.setTextColor(0, 0, 0);
      }
  
      // ë³¸ë¬¸
      else if (line.trim() !== "") {
        doc.setFontSize(10.5);
        const wrapped = doc.splitTextToSize(line, 180);
        wrapped.forEach((w) => {
          if (y > 280) {
            doc.addPage();
            y = 20;
          }
          doc.text(w, 18, y);
          y += 5.5;
        });
      }
  
      else {
        y += 3; // ë¹ˆ ì¤„
      }
    });
  
    doc.save(filename);
  }



  // ê°•ì˜ ì •ë¦¬ ë…¸íŠ¸ PDF ë‹¤ìš´ë¡œë“œ
  function downloadNotePDF() {
    const noteText = document.getElementById("noteOutput").value;
    const subjectName =
      document.getElementById("subjectName").value.trim() || "ê³¼íƒ‘ì˜_ë¹„ë°€_ë…¸íŠ¸";

    const title = `ê³¼íƒ‘ì˜ ë¹„ë°€ ë…¸íŠ¸ - ${subjectName}`;
    const fileName = subjectName.replace(/\s+/g, "_") + "_ìš”ì•½.pdf";

    createPdfFromText(noteText, title, fileName);
  }

  // ë¬¸ì œì§€ PDF ë‹¤ìš´ë¡œë“œ
  function downloadQuizPDF() {
    const quizText = document.getElementById("quizOutput").value;
    const subjectName =
      document.getElementById("subjectName").value.trim() || "ê³¼íƒ‘ì˜_ë¹„ë°€_ë…¸íŠ¸";

    const title = `ê³¼íƒ‘ì˜ ë¹„ë°€ ë…¸íŠ¸ - ${subjectName} (ë¬¸ì œì§€)`;
    const fileName = subjectName.replace(/\s+/g, "_") + "_ë¬¸ì œì§€.pdf";

    createPdfFromText(quizText, title, fileName);
  }

    
  </script>
</body>
</html>












